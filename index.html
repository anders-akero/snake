<canvas id ="gc" width="400" height="400"></canvas>

<script>
window.onload = function() {
    canvas = document.getElementById('gc');
    ctx = canvas.getContext('2d');
    document.addEventListener('keydown', keyPush);
    setInterval(action, 1000/5);
};

// player start pos
let px = py = 10;

// grid size
let gs = tc = 20;

// apple start pos
let ax = ay = 15;

// players next step from current pos
let xv = yv = 0;
xv = 1;// sending the player to the right on start

// history of the snake
const trail = [];

// default tail lenght
const defaultTailLength = 5;
let tail = defaultTailLength;

function action() {
    px += xv;
    py += yv;

    // wrapping the game, IE move the snake to the other side
    if (px < 0) {
        px = tc - 1;
    }
    if (px > tc-1) {
        px = 0;
    }
    if (py < 0) {
        py = tc - 1;
    }
    if (py > tc-1) {
        py = 0;
    }

    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = 'lime';
    for (let i = 0; i < trail.length; i++) {
        ctx.fillRect(trail[i].x*gs, trail[i].y*gs, gs-2, gs-2);
        if (trail[i].x === px && trail[i].y === py) {
            // user eat their own tail
            tail = defaultTailLength;
        }
    }
    // adding new location to history
    trail.push({x: px, y: py});
    while (trail.length > tail) {
        trail.shift();
    }

    if (ax === px && ay === py) {
        // user eat an apple
        tail++;
        // give the apple a new random location
//TODO: Make sure that the apple can not be at a location where the tail already is.
//TODO: If no empty space left. Then the player win
        ax = Math.floor(Math.random() * tc);
        ay = Math.floor(Math.random() * tc);
    }

    ctx.fillStyle = 'red';
    ctx.fillRect(ax*gs, ay*gs, gs-2, gs-2);
}

function keyPush(e) {
//TODO: Make sure the user can not go backwards
    switch(e.key) {
        case 'ArrowLeft':
            xv = -1;
            yv = 0;
            break;
        case 'ArrowUp':
            xv = 0;
            yv = -1;
            break;
        case 'ArrowRight':
            xv = 1;
            yv = 0;
            break;
        case 'ArrowDown':
            xv = 0;
            yv = 1;
            break;
    }
    action();
}
</script>
